# .github/workflows/anomaly-detect.yml
name: "On-Chain Anomaly Detection"
on:
  workflow_dispatch:   # <-- allows manual runs
  schedule:
    - cron: '*/15 * * * *'  # every 15 minutes
jobs:
  detect:
    runs-on: ubuntu-latest
    env:
      ETH_RPC: ${{ secrets.ETH_RPC }}
      WINDOW: 1000
      CONTAMINATION: 0.01
    steps:
      - uses: actions/checkout@v3
      - name: Install & Run Detector
        run: |
          pip install pandas scikit-learn web3
          python scripts/detect_anomalies.py \
            --window 1000 --contamination 0.01 \
            --out data/anomalies.json
      - name: Commit Findings
        run: |
          git config user.name "cspannos"
          git config user.email "@users.noreply.github.com"
          git add data/anomalies.json
          git diff --quiet || git commit -m "chore: log on-chain anomalies" && git push
